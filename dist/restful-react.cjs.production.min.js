"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=t(require("lodash/debounce")),r=t(require("lodash/isEqual")),n=require("react"),a=t(require("lodash/noop")),o=t(require("url")),s=t(require("qs")),i=t(require("lodash/merge")),u=t(require("react-fast-compare")),c=t(require("lodash/isEqualWith"));function l(t,e,r,n,a,o,s){try{var i=t[o](s),u=i.value}catch(t){return void r(t)}i.done?e(u):Promise.resolve(u).then(n,a)}function p(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function s(t){l(o,n,a,s,i,"next",t)}function i(t){l(o,n,a,s,i,"throw",t)}s(void 0)}))}}function f(){return(f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d,y=(function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(t,e,r,a){var o=Object.create((e&&e.prototype instanceof f?e:f).prototype),s=new w(a||[]);return n(o,"_invoke",{value:q(t,r,s)}),o}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var p={};function f(){}function h(){}function d(){}var y={};u(y,o,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(E([])));b&&b!==e&&r.call(b,o)&&(y=b);var g=d.prototype=f.prototype=Object.create(y);function m(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var a;n(this,"_invoke",{value:function(n,o){function s(){return new e((function(a,s){!function n(a,o,s,i){var u=l(t[a],t,o);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==typeof p&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){n("next",t,s,i)}),(function(t){n("throw",t,s,i)})):e.resolve(p).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,i)}))}i(u.arg)}(n,o,a,s)}))}return a=a?a.then(s,s):s()}})}function q(t,e,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var i=P(s,r);if(i){if(i===p)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function P(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,P(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,p;var a=n.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function E(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,n(g,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:h,configurable:!0}),h.displayName=u(d,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var s=new x(c(e,r,n,a),o);return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},m(g),u(g,i,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return s.type="throw",s.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var i=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(i&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;k(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(d={exports:{}}),d.exports),v=["children"],b=n.createContext({base:"",parentPath:"",resolve:function(t){return t},requestOptions:{},onError:a,onRequest:a,onResponse:a,queryParams:{},queryParamStringifyOptions:{},children:null}),g=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.render=function(){var t=this.props,e=t.children,r=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)e.indexOf(r=o[n])>=0||(a[r]=t[r]);return a}(t,v);return n.createElement(b.Provider,{value:f({onError:a,onRequest:a,onResponse:a,resolve:function(t){return t},requestOptions:{},parentPath:"",queryParams:{},queryParamStringifyOptions:{},children:null},r)},e)},e}(n.Component);g.displayName="RestfulProviderContext";var m=b.Consumer,x=function(t,e,r){void 0===t&&(t=""),void 0===e&&(e=""),void 0===r&&(r="");var n=q(e,r);return""===t&&n.startsWith("/")?n:t.endsWith("/")?""+t.slice(0,-1)+n:""+t+n},q=function(t,e){return void 0===t&&(t=""),void 0===e&&(e=""),e.startsWith("/")&&e.length>1?o.resolve(t,e):""!==e&&"/"!==e?t+"/"+e:t},P=function(t){return{message:O(t),data:t}},O=function(t){var e="Failed to fetch, unknown error";return t instanceof Error&&(e="Failed to fetch: "+k(t)),e},k=function(t){var e="unknown error";return t instanceof Error&&(e=""+t.message),e},w=function(){var t=p(y.mark((function t(e){return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(204!==e.status){t.next=2;break}return t.abrupt("return",{data:void 0,responseError:!1});case 2:if(!(e.headers.get("content-type")||"").includes("application/json")){t.next=15;break}return t.prev=3,t.next=6,e.json();case 6:return t.t0=t.sent,t.abrupt("return",{data:t.t0,responseError:!1});case 10:return t.prev=10,t.t1=t.catch(3),t.abrupt("return",{data:O(t.t1),responseError:!0});case 13:t.next=29;break;case 15:if(!(e.headers.get("content-type")||"").includes("text/plain")&&!(e.headers.get("content-type")||"").includes("text/html")){t.next=28;break}return t.prev=16,t.next=19,e.text();case 19:return t.t2=t.sent,t.abrupt("return",{data:t.t2,responseError:!1});case 23:return t.prev=23,t.t3=t.catch(16),t.abrupt("return",{data:O(t.t3),responseError:!0});case 26:t.next=29;break;case 28:return t.abrupt("return",{data:e,responseError:!1});case 29:case"end":return t.stop()}}),t,null,[[3,10],[16,23]])})));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=p(y.mark((function t(e){var r,n,a,o,s;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.data,n=e.resolve,a=null,o=null,t.prev=3,!n){t.next=16;break}if(!(s=n(r)).then){t.next=12;break}return t.next=9,s;case 9:t.t0=t.sent,t.next=13;break;case 12:t.t0=s;case 13:a=t.t0,t.next=17;break;case 16:a=r;case 17:t.next=23;break;case 19:t.prev=19,t.t1=t.catch(3),a=null,o={message:"RESOLVE_ERROR",data:JSON.stringify(t.t1)};case 23:return t.abrupt("return",{data:a,error:o});case 24:case"end":return t.stop()}}),t,null,[[3,19]])})));return function(e){return t.apply(this,arguments)}}();function S(t,e,r,n){void 0===n&&(n={});var a=n.queryParamOptions,i=n.stripTrailingSlash,u=t.endsWith("/")?t:t+"/",c=e.startsWith("/")?e.slice(1):e,l=Object.keys(r||{}).length?c+"?"+s.stringify(r,a):c,p=Boolean(l)?o.resolve(u,l):u;return i&&p.endsWith("/")?p.slice(0,-1):p}var R=function(t){function a(r){var n;return(n=t.call(this,r)||this).abortController=new AbortController,n.signal=n.abortController.signal,n.state={data:null,response:null,loading:!n.props.lazy,error:null},n.getRequestOptions=function(){var t=p(y.mark((function t(e,r,a){var o,s;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof(o=n.props.requestOptions)){t.next=9;break}return t.next=4,o(e,"GET");case 4:if(t.t0=t.sent,t.t0){t.next=7;break}t.t0={};case 7:return t.abrupt("return",f({},r,s=t.t0,{headers:new Headers(f({},"boolean"!=typeof a?a:{},(r||{}).headers,s.headers))}));case 9:return t.abrupt("return",f({},r,o,{headers:new Headers(f({},"boolean"!=typeof a?a:{},(r||{}).headers,(o||{}).headers))}));case 10:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),n.fetch=function(){var t=p(y.mark((function t(e,r){var a,o,s,i,u,c,l,p,f,h,d,v,b,g,m,x,O,k;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=(a=n.props).base,s=a.__internal_hasExplicitBase,i=a.parentPath,u=a.path,c=a.resolve,l=a.onError,p=a.onRequest,f=a.onResponse,!n.state.error&&n.state.loading||n.setState((function(){return{error:null,loading:!0}})),h=function(){var t=s?u:q(i,u);return S(o,t,n.props.queryParams,{stripTrailingSlash:!0,queryParamOptions:n.props.queryParamStringifyOptions})},t.t0=Request,t.t1=h(),t.next=7,n.getRequestOptions(h(),r);case 7:return t.t2=t.sent,d=new t.t0(t.t1,t.t2),p&&p(d),t.prev=10,t.next=13,fetch(d,{signal:n.signal});case 13:return b=(v=t.sent).clone(),f&&f(v.clone()),t.next=18,w(v);case 18:if(m=(g=t.sent).data,x=g.responseError,!n.signal.aborted){t.next=23;break}return t.abrupt("return");case 23:if(v.ok&&!x){t.next=28;break}return n.setState({loading:!1,error:O={message:"Failed to fetch: "+v.status+" "+v.statusText+(x?" - "+m:""),data:m,status:v.status},data:null,response:b}),!n.props.localErrorOnly&&l&&l(O,(function(){return n.fetch(e,r)}),v),t.abrupt("return",null);case 28:return t.next=30,E({data:m,resolve:c});case 30:return n.setState({loading:!1,data:(k=t.sent).data,error:k.error,response:b}),t.abrupt("return",m);case 35:if(t.prev=35,t.t3=t.catch(10),!n.signal.aborted){t.next=39;break}return t.abrupt("return");case 39:n.setState({loading:!1,data:null,error:P(t.t3)});case 40:case"end":return t.stop()}}),t,null,[[10,35]])})));return function(e,r){return t.apply(this,arguments)}}(),"object"==typeof r.debounce?n.fetch=e(n.fetch,r.debounce.wait,r.debounce.options):"number"==typeof r.debounce?n.fetch=e(n.fetch,r.debounce):r.debounce&&(n.fetch=e(n.fetch)),n}h(a,t);var o=a.prototype;return o.componentDidMount=function(){this.props.lazy||this.fetch()},o.componentDidUpdate=function(t){var e=t.resolve,n=t.requestOptions;(t.base!==this.props.base||t.parentPath!==this.props.parentPath||t.path!==this.props.path||!r(t.queryParams,this.props.queryParams)||e&&this.props.resolve&&e.toString()!==this.props.resolve.toString()||n&&this.props.requestOptions&&n.toString()!==this.props.requestOptions.toString())&&(this.props.lazy||this.fetch())},o.componentWillUnmount=function(){this.abortController.abort()},o.render=function(){var t=this.props,e=t.children,r=t.path,a=t.base,o=t.parentPath,s=this.state,i=s.data,u=s.error,c=s.loading,l=s.response;return t.wait&&null===i&&!u?n.createElement(n.Fragment,null):e(i,{loading:c,error:u},{refetch:this.fetch},{response:l,absolutePath:x(a,o,r)})},a}(n.Component);function j(t){return n.createElement(m,null,(function(e){return n.createElement(g,Object.assign({},e,{parentPath:q(e.parentPath,t.path)}),n.createElement(R,Object.assign({},e,t,{queryParams:f({},e.queryParams,t.queryParams),__internal_hasExplicitBase:Boolean(t.base),queryParamStringifyOptions:f({},e.queryParamStringifyOptions,t.queryParamStringifyOptions)})))}))}R.defaultProps={base:"",parentPath:"",resolve:function(t){return t},queryParams:{}};var _=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).state={data:null,previousData:null,loading:!e.props.lazy,lastResponse:null,polling:!e.props.lazy,finished:!1,error:null},e.keepPolling=!e.props.lazy,e.abortController=new AbortController,e.signal=e.abortController.signal,e.isModified=function(t,r){return 304!==t.status&&!u(e.state.data,r)},e.getRequestOptions=function(t){return"function"==typeof e.props.requestOptions?e.props.requestOptions(t,"GET"):e.props.requestOptions||{}},e.isResponseOk=function(t){return t.ok||304===t.status},e.cycle=p(y.mark((function t(){var r,n,a,o,s,i,u,c,l,p,h,d,v,b,g;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.keepPolling){t.next=2;break}return t.abrupt("return");case 2:if(!e.props.until||!e.props.until(e.state.data,e.state.lastResponse)){t.next=5;break}return e.stop(),t.abrupt("return");case 5:return n=(r=e.props).interval,a=r.wait,o=r.onError,s=r.onRequest,i=r.onResponse,u=e.state.lastPollIndex,c=S(r.base,r.path,e.props.queryParams,{queryParamOptions:e.props.queryParamStringifyOptions,stripTrailingSlash:!0}),t.next=10,e.getRequestOptions(c);case 10:return l=t.sent,p=new Request(c,f({},l,{headers:f({Prefer:"wait="+a+"s;"+(u?"index="+u:"")},l.headers)})),s&&s(p),t.prev=13,t.next=16,fetch(p,{signal:e.signal});case 16:return h=t.sent,i&&i(h.clone()),t.next=20,w(h);case 20:if(v=(d=t.sent).data,b=d.responseError,e.keepPolling&&!e.signal.aborted){t.next=25;break}return t.abrupt("return");case 25:return!e.isResponseOk(h)||b?(e.setState({loading:!1,lastResponse:h,error:g={message:"Failed to poll: "+h.status+" "+h.statusText+(b?" - "+v:""),data:v,status:h.status}}),!e.props.localErrorOnly&&o&&o(g,(function(){return Promise.resolve()}),h)):e.isModified(h,v)&&e.setState((function(t){return{loading:!1,lastResponse:h,previousData:t.data,data:v,error:null,lastPollIndex:h.headers.get("x-polling-index")||void 0}})),t.next=28,new Promise((function(t){return setTimeout(t,n)}));case 28:e.cycle(),t.next=33;break;case 31:t.prev=31,t.t0=t.catch(13);case 33:case"end":return t.stop()}}),t,null,[[13,31]])}))),e.start=function(){e.keepPolling=!0,e.state.polling||e.setState((function(){return{polling:!0}})),e.cycle()},e.stop=function(){e.keepPolling=!1,e.setState((function(){return{polling:!1,finished:!0}}))},e}h(e,t);var r=e.prototype;return r.componentDidMount=function(){var t=this.props,e=t.lazy;if(void 0===t.path)throw new Error('[restful-react]: You\'re trying to poll something without a path. Please specify a "path" prop on your Poll component.');e||this.start()},r.componentWillUnmount=function(){this.abortController.abort(),this.stop()},r.render=function(){var t=this.state,e=t.lastResponse,r=t.previousData,n=t.data,a=t.polling,o=t.loading,s=t.error,i=t.finished,u=this.props,c=u.children,l=u.resolve,p={response:e,absolutePath:x(u.base,"",u.path)},f={polling:a,loading:o,error:s,finished:i},h={stop:this.stop,start:this.start};return c(e&&l?l(n,r):n,f,h,p)},e}(n.Component);_.defaultProps={interval:1e3,wait:60,base:"",resolve:function(t){return t},queryParams:{}};var L=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).state={loading:!1,error:null},e.abortController=new AbortController,e.signal=e.abortController.signal,e.mutate=function(){var t=p(y.mark((function t(r,n){var a,o,s,i,u,c,l,p,h,d,v,b,g,m,x,O,k,E,R,j;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(a=e.props).__internal_hasExplicitBase,s=a.base,i=a.parentPath,u=a.path,c=a.verb,l=a.requestOptions,p=a.onError,h=a.onRequest,d=a.onResponse,v=a.pathInlineBodyEncode,b=a.resolve,e.setState((function(){return{error:null,loading:!0}})),g=function(){var t="DELETE"===c&&"string"==typeof r?q(u,v?v(r):r):u,n=o?t||"":q(i,t);return S(s,n,e.props.queryParams,{stripTrailingSlash:!0,queryParamOptions:e.props.queryParamStringifyOptions})},t.t0=Request,t.t1=g(),t.t2=f,t.t3={method:c,body:r instanceof FormData?r:"object"==typeof r?JSON.stringify(r):r},"function"!=typeof l){t.next=13;break}return t.next=10,l(g(),c,r);case 10:t.t4=t.sent,t.next=14;break;case 13:t.t4=l;case 14:if(t.t5=t.t4,t.t6=n,t.t7=f,t.t8={},"function"!=typeof l){t.next=24;break}return t.next=21,l(g(),c,r);case 21:t.t9=t.sent.headers,t.next=25;break;case 24:t.t9=(l||{}).headers;case 25:return t.t10=t.t9,t.t11=n?n.headers:{},t.t12=(0,t.t7)(t.t8,t.t10,t.t11),t.t13={headers:t.t12},t.t14=(0,t.t2)(t.t3,t.t5,t.t6,t.t13),m=new t.t0(t.t1,t.t14),r instanceof FormData||m.headers.has("content-type")||m.headers.set("content-type","object"==typeof r?"application/json":"text/plain"),h&&h(m),t.prev=33,t.next=36,fetch(m,{signal:e.signal});case 36:x=t.sent,d&&d(x.clone()),t.next=46;break;case 40:throw t.prev=40,t.t15=t.catch(33),O=P(t.t15),e.setState({error:O,loading:!1}),!e.props.localErrorOnly&&p&&p(O,(function(){return e.mutate(r,n)})),O;case 46:return t.next=48,w(x);case 48:E=(k=t.sent).data,R=k.responseError,t.prev=51,j=b?b(E):E,t.next=61;break;case 55:if(t.prev=55,t.t16=t.catch(51),!e.signal.aborted){t.next=59;break}return t.abrupt("return");case 59:throw e.setState({error:P(t.t16),loading:!1}),t.t16;case 61:if(!e.signal.aborted){t.next=63;break}return t.abrupt("return");case 63:if(x.ok&&!R){t.next=68;break}throw e.setState({error:O={data:j,message:"Failed to fetch: "+x.status+" "+x.statusText,status:x.status},loading:!1}),!e.props.localErrorOnly&&p&&p(O,(function(){return e.mutate(r,n)}),x),O;case 68:return e.setState({loading:!1}),e.props.onMutate&&e.props.onMutate(r,j),t.abrupt("return",j);case 71:case"end":return t.stop()}}),t,null,[[33,40],[51,55]])})));return function(e,r){return t.apply(this,arguments)}}(),e}h(e,t);var r=e.prototype;return r.componentWillUnmount=function(){this.abortController.abort()},r.render=function(){var t=this.props,e=this.state;return(0,t.children)(this.mutate,{loading:e.loading,error:e.error},{absolutePath:x(t.base,t.parentPath,t.path)})},e}(n.Component);function C(t){var e=n.useRef();return c(t,e.current,(function(t,e){if("function"==typeof t&&"function"==typeof e)return t.toString()===e.toString()}))||(e.current=t),e.current}function T(t,e){n.useEffect(t,C(e))}function F(t,e){return n.useCallback(t,C(e))}function G(){try{return new AbortController}catch(t){return}}function D(){var t=n.useRef(G());return{abort:n.useCallback((function(){t&&t.current&&(t.current.abort(),t.current=G())}),[t]),getAbortSignal:function(){var e;return null==t?void 0:null==(e=t.current)?void 0:e.signal}}}L.defaultProps={base:"",parentPath:"",path:"",queryParams:{}};var N=function(t){return"function"==typeof t.cancel&&"function"==typeof t.flush},z={};exports.Get=j,exports.Mutate=function(t){return n.createElement(m,null,(function(e){return n.createElement(g,Object.assign({},e,{parentPath:q(e.parentPath,t.path)}),n.createElement(L,Object.assign({},e,t,{queryParams:f({},e.queryParams,t.queryParams),queryParamStringifyOptions:f({},e.queryParamStringifyOptions,t.queryParamStringifyOptions),__internal_hasExplicitBase:Boolean(t.base)})))}))},exports.Poll=function(t){return n.createElement(m,null,(function(e){return n.createElement(_,Object.assign({},e,t,{queryParams:f({},e.queryParams,t.queryParams),requestOptions:(r=p(y.mark((function r(n,a){var o;return y.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("function"!=typeof e.requestOptions){r.next=6;break}return r.next=3,e.requestOptions(n,a);case 3:r.t0=r.sent,r.next=7;break;case 6:r.t0=e.requestOptions||{};case 7:if(o=r.t0,"function"!=typeof t.requestOptions){r.next=14;break}return r.next=11,t.requestOptions(n,a);case 11:r.t1=r.sent,r.next=15;break;case 14:r.t1=t.requestOptions||{};case 15:return r.abrupt("return",i(o,r.t1));case 17:case"end":return r.stop()}}),r)}))),function(t,e){return r.apply(this,arguments)}),queryParamStringifyOptions:f({},e.queryParamStringifyOptions,t.queryParamStringifyOptions)}));var r}))},exports.RestfulProvider=g,exports.default=j,exports.useGet=function(){var t="object"==typeof arguments[0]?arguments[0]:f({},arguments[1],{path:arguments[0]}),r=n.useContext(b),a=t.path,o=t.pathParams,s=void 0===o?{}:o,u=n.useState({data:null,response:null,loading:!t.lazy,error:null}),c=u[0],l=u[1],h=D(),d=h.abort,v=h.getAbortSignal,g="function"==typeof a?a(s):a,m=F(function(){var t=p(y.mark((function t(e,r,n,a){var o,s,u,c,p,h,d,v,b,g,x,q,O,k,E,R,j,_,L,C,T,F,G,D,N,z;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=void 0===(o=e.base)?r.base:o,u=e.path,p=void 0===(c=e.resolve)?r.resolve||function(t){return t}:c,d=void 0===(h=e.queryParams)?{}:h,b=void 0===(v=e.queryParamStringifyOptions)?{}:v,g=e.requestOptions,q=void 0===(x=e.pathParams)?{}:x,l((function(t){return t.error||!t.loading?f({},t,{error:null,loading:!0}):t})),O="function"==typeof u?u(q):u,k=S(s,O,f({},r.queryParams,d),{queryParamOptions:f({},r.queryParamStringifyOptions,b)}),"function"!=typeof g){t.next=10;break}return t.next=7,g(k,"GET");case 7:t.t1=t.sent,t.next=11;break;case 10:t.t1=g;case 11:if(t.t0=t.t1,t.t0){t.next=14;break}t.t0={};case 14:if(E=t.t0,"function"!=typeof r.requestOptions){t.next=21;break}return t.next=18,r.requestOptions(k,"GET");case 18:t.t3=t.sent,t.next=22;break;case 21:t.t3=r.requestOptions;case 22:if(t.t2=t.t3,t.t2){t.next=25;break}t.t2={};case 25:return R=t.t2,j=a(),_=new Request(k,i({},R,E,{signal:j})),r.onRequest&&r.onRequest(_),t.prev=29,t.next=32,fetch(_);case 32:return C=(L=t.sent).clone(),r.onResponse&&r.onResponse(C),t.next=37,w(L);case 37:if(F=(T=t.sent).data,G=T.responseError,!j||!j.aborted){t.next=42;break}return t.abrupt("return");case 42:if(L.ok&&!G){t.next=47;break}return D={message:"Failed to fetch: "+L.status+" "+L.statusText+(G?" - "+F:""),data:F,status:L.status},l((function(t){return f({},t,{loading:!1,data:null,error:D,response:C})})),!e.localErrorOnly&&r.onError&&r.onError(D,(function(){return m(e,r,n,a)}),L),t.abrupt("return");case 47:return N=p(F),l((function(t){return f({},t,{error:null,loading:!1,data:N,response:C})})),t.abrupt("return",N);case 52:if(t.prev=52,t.t4=t.catch(29),!j||!j.aborted){t.next=56;break}return t.abrupt("return");case 56:return z=P(t.t4),l((function(t){return f({},t,{data:null,loading:!1,error:z})})),!e.localErrorOnly&&r.onError&&r.onError(z,(function(){return m(e,r,n,a)})),t.abrupt("return");case 60:case"end":return t.stop()}}),t,null,[[29,52]])})));return function(e,r,n,a){return t.apply(this,arguments)}}(),[t.lazy,t.mock,t.path,t.base,t.resolve,t.queryParams,t.requestOptions,t.pathParams,r.base,r.parentPath,r.queryParams,r.requestOptions,d]),x=n.useCallback("object"==typeof t.debounce?e(m,t.debounce.wait,t.debounce.options):"number"==typeof t.debounce?e(m,t.debounce):t.debounce?e(m):m,[m,t.debounce]);n.useEffect((function(){return t.lazy||t.mock||x(t,r,d,v),function(){N(x)&&x.cancel(),d()}}),[x,t.lazy,t.mock]);var q=n.useCallback((function(e){return void 0===e&&(e={}),x(f({},t,e),r,d,v)}),[x]);return f({},c,t.mock,{absolutePath:S(t.base||r.base,g,f({},r.queryParams,t.queryParams),{queryParamOptions:f({},r.queryParamStringifyOptions,t.queryParamStringifyOptions)}),cancel:function(){l(f({},c,{loading:!1})),d()},refetch:q})},exports.useMutate=function(){var t="object"==typeof arguments[0]?arguments[0]:f({},arguments[2],{path:arguments[1],verb:arguments[0]}),e=n.useContext(b),r=t.verb,a=t.base,o=void 0===a?e.base:a,s=t.path,u=t.queryParams,c=void 0===u?z:u,l=t.resolve,h=void 0===l?e.resolve:l,d=t.pathParams,v=void 0===d?z:d,g="DELETE"===r,m=n.useState({error:null,loading:!1}),x=m[0],q=m[1],P=D(),O=P.abort,E=P.getAbortSignal;n.useEffect((function(){return function(){return O()}}),[O]);var R=t.pathInlineBodyEncode,j=t.queryParamStringifyOptions,_=t.requestOptions,L=t.localErrorOnly,C=t.onMutate,G=[s,v,c,r,g,o,e,j,_,C,O,R,L,h],N=F(function(){var t=p(y.mark((function t(n,a){var u,l,p,d,b,m,x,P,O,T,F,G,D,z,M;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=E(),q((function(t){return t.error||!t.loading?f({},t,{loading:!0,error:null}):t})),l="function"==typeof s?s((null==a?void 0:a.pathParams)||v):s,p=[l],d={method:r},n instanceof FormData||(d.headers={"content-type":"object"==typeof n?"application/json":"text/plain"}),n instanceof FormData?d.body=n:"object"==typeof n?d.body=JSON.stringify(n):g&&void 0!==n?(b=R?R(String(n)):String(n),p.push(b)):d.body=n,m=S(o,p.join("/"),f({},e.queryParams,c,null==a?void 0:a.queryParams),{queryParamOptions:f({},e.queryParamStringifyOptions,j)}),"function"!=typeof _){t.next=14;break}return t.next=11,_(m,r,n);case 11:t.t1=t.sent,t.next=15;break;case 14:t.t1=_;case 15:if(t.t0=t.t1,t.t0){t.next=18;break}t.t0={};case 18:if(x=t.t0,"function"!=typeof e.requestOptions){t.next=25;break}return t.next=22,e.requestOptions(m,r,n);case 22:t.t3=t.sent,t.next=26;break;case 25:t.t3=e.requestOptions;case 26:if(t.t2=t.t3,t.t2){t.next=29;break}t.t2={};case 29:return P=new Request(m,i({},t.t2,d,x,a,{signal:u})),e.onRequest&&e.onRequest(P),t.prev=32,t.next=35,fetch(P);case 35:O=t.sent,e.onResponse&&e.onResponse(O.clone()),t.next=45;break;case 39:throw t.prev=39,t.t4=t.catch(32),T={message:"Failed to fetch: "+k(t.t4),data:""},q({error:T,loading:!1}),!L&&e.onError&&e.onError(T,(function(){return N(n,a)})),T;case 45:return t.next=47,w(O);case 47:G=(F=t.sent).data,D=F.responseError,t.prev=50,z=h?h(G):G,t.next=61;break;case 54:if(t.prev=54,t.t5=t.catch(50),!u||!u.aborted){t.next=58;break}return t.abrupt("return");case 58:throw T={data:k(t.t5),message:"Failed to resolve: "+k(t.t5)},q((function(t){return f({},t,{error:T,loading:!1})})),t.t5;case 61:if(!u||!u.aborted){t.next=63;break}return t.abrupt("return");case 63:if(O.ok&&!D){t.next=68;break}throw M={data:z,message:"Failed to fetch: "+O.status+" "+O.statusText,status:O.status},q((function(t){return f({},t,{error:M,loading:!1})})),!L&&e.onError&&e.onError(M,(function(){return N(n)}),O),M;case 68:return q((function(t){return f({},t,{loading:!1})})),C&&C(n,z),t.abrupt("return",z);case 71:case"end":return t.stop()}}),t,null,[[32,39],[50,54]])})));return function(e,r){return t.apply(this,arguments)}}(),G);return T((function(){x.loading&&O()}),G),f({},x,{mutate:N},t.mock,{cancel:function(){q((function(t){return f({},t,{loading:!1})})),O()}})};
//# sourceMappingURL=restful-react.cjs.production.min.js.map
